{% extends "base.html" %}

{% block title %}Create Certificate - qPKI{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">
            <i class="fas fa-file-contract me-2 text-primary"></i>Create Certificate
        </h1>
        <div class="btn-toolbar mb-2 mb-md-0">
            <a href="{{ url_for('list_certs') }}" class="btn btn-outline-secondary">
                <i class="fas fa-list me-1"></i>View Certificates
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header quantum-gradient text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-plus me-2"></i>New Certificate
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <!-- Certificate Authority Selection -->
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-certificate me-2"></i>Certificate Authority
                        </h6>
                        
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <label for="ca_filename" class="form-label">Signing CA *</label>
                                <select class="form-select" id="ca_filename" name="ca_filename" required>
                                    <option value="">Select Certificate Authority...</option>
                                    {% for ca in cas %}
                                        <option value="{{ ca.filename }}">{{ ca.common_name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">Choose the CA that will sign this certificate</div>
                            </div>
                        </div>

                        <!-- Certificate Subject Information -->
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-id-card me-2"></i>Certificate Subject Information
                        </h6>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="common_name" class="form-label">Common Name (CN) *</label>
                                <input type="text" class="form-control" id="common_name" name="common_name" required
                                       placeholder="e.g., www.example.com or John Doe">
                                <div class="form-text">Domain name for server certs, or person name for client certs</div>
                            </div>
                            <div class="col-md-6">
                                <label for="organization" class="form-label">Organization (O)</label>
                                <input type="text" class="form-control" id="organization" name="organization"
                                       placeholder="e.g., MyCompany Inc">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="organizational_unit" class="form-label">Organizational Unit (OU)</label>
                                <input type="text" class="form-control" id="organizational_unit" name="organizational_unit"
                                       placeholder="e.g., IT Department">
                            </div>
                            <div class="col-md-6">
                                <label for="country" class="form-label">Country (C)</label>
                                <input type="text" class="form-control" id="country" name="country" 
                                       maxlength="2" minlength="2"
                                       placeholder="e.g., US" style="text-transform: uppercase;">
                                <div class="form-text">2-letter country code</div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-4">
                                <label for="state" class="form-label">State/Province</label>
                                <input type="text" class="form-control" id="state" name="state"
                                       placeholder="e.g., California">
                            </div>
                            <div class="col-md-4">
                                <label for="locality" class="form-label">Locality/City</label>
                                <input type="text" class="form-control" id="locality" name="locality"
                                       placeholder="e.g., San Francisco">
                            </div>
                            <div class="col-md-4">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="email" name="email"
                                       placeholder="e.g., user@example.com">
                            </div>
                        </div>

                        <!-- Certificate Parameters -->
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-cog me-2"></i>Certificate Parameters
                        </h6>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="validity_days" class="form-label">Validity Period *</label>
                                <select class="form-select" id="validity_days" name="validity_days" required>
                                    <option value="30">30 days (Testing)</option>
                                    <option value="90">90 days (Short-term)</option>
                                    <option value="365" selected>1 year (Standard)</option>
                                    <option value="730">2 years (Extended)</option>
                                    <option value="1095">3 years (Long-term)</option>
                                </select>
                                <div class="form-text">How long this certificate should be valid</div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Create Certificate
                            </button>
                            <a href="{{ url_for('list_certs') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Information Panel -->
        <div class="col-lg-4">
            <div class="card shadow">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>Certificate Information
                    </h6>
                </div>
                <div class="card-body">
                    <p class="mb-3">
                        This certificate will be signed by the selected CA and inherit its 
                        cryptographic algorithms and security properties.
                    </p>
                    
                    <h6><i class="fas fa-shield-alt text-primary me-2"></i>Security Features</h6>
                    <ul class="list-unstyled ms-3">
                        <li><i class="fas fa-check text-success me-2"></i>Hybrid signatures</li>
                        <li><i class="fas fa-check text-success me-2"></i>CA-signed validity</li>
                        <li><i class="fas fa-check text-success me-2"></i>Quantum-resistant</li>
                    </ul>

                    <h6 class="mt-3"><i class="fas fa-lightbulb text-warning me-2"></i>Tips</h6>
                    <ul class="list-unstyled ms-3">
                        <li class="mb-2">
                            <small>
                                <i class="fas fa-info-circle text-info me-1"></i>
                                Use domain names (e.g., www.example.com) for server certificates
                            </small>
                        </li>
                        <li class="mb-2">
                            <small>
                                <i class="fas fa-info-circle text-info me-1"></i>
                                Use person names (e.g., John Doe) for client certificates
                            </small>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="alert alert-info mt-3">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Note:</strong> The certificate will use the same cryptographic algorithms 
                as the selected Certificate Authority.
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Auto-uppercase country code
    document.getElementById('country').addEventListener('input', function() {
        this.value = this.value.toUpperCase();
    });
</script>
{% endblock %}
